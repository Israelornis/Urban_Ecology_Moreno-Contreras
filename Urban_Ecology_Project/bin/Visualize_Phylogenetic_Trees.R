#########################################################
# Script to visualize phylogenetic and functional trees #
#########################################################

### Script elaborated by Israel Moreno-Contreras (Ornithology, UNAM)

### Install libraries
library(ape)
library(picante)
library(phytools) ### K's Blomberg, phylogenetic signal
library(dendextend) # To visualize phylogenetic and functional trees
library(ggtree)

### Read phylogenetic tree 
phylogenetic_tree <- read.tree("..\\data\\input_data\\prunned_tree.tre")

### Read functional tree 
functional_tree <- read.tree("..\\data\\input_data\\functional_tree_scaled.tre")

### Creat vector with species names
Species_name <- traits_zstandardized$Species

phylogenetic_tree <- makeLabel(phylogenetic_tree)
functional_tree <- makeLabel(functional_tree)

### Create associations matrix 
a <- as.character(Species_name)
b <- as.character(Species_name)
association <- cbind(a, b)
association <- cbind(phylogenetic_tree$tip.label, phylogenetic_tree$tip.label)

# Plot cophylot
cophyloplot(phylogenetic_tree, functional_tree, rotate=FALSE, assoc = association, 
            length.line = 4, space = 28, gap = 3, type = "phylogram",
            show.tip.label = FALSE)
lad_phy_tree <- as.phylo(ladderize(phylogenetic_tree, right = TRUE))
plot(lad_phy_tree)

### Visualize trees using dendextend library
tanglegram(phylogenetic_tree, functional_tree, sort = TRUE, common_subtrees_color_lines = FALSE, 
           highlight_distinct_edges  = FALSE, highlight_branches_lwd = FALSE, 
           axes = FALSE, lab.cex = 0.5, lwd = 0.5)

tiff(filename="..\\data\\output_data\\Phylogenetic_Functional_trees.tif", compression = "lzw", units="mm", width=174, height=110, pointsize=9, res=1000)
tanglegram(phylogenetic_tree, functional_tree, sort = TRUE, common_subtrees_color_lines = FALSE, color_lines = pallete, 
           highlight_distinct_edges  = FALSE, highlight_branches_lwd = FALSE, 
           axes = FALSE, lab.cex = 0.6, lwd = 1, margin_bottom = 2, margin_top = 2, 
           main_left = "Phylogenetic Tree", main_right = "Functional Tree", 
           rank_branches =TRUE, cex_main_left = 2, cex_main_right = 2)
dev.off()

pallete <- c("#ff4e8e",
             "#3bdb64",
             "#a32fb6",
             "#35c245",
             "#983cc3",
             "#69cb3d",
             "#3a41c2",
             "#a2c612",
             "#3a53d8",
             "#afd433",
             "#7a55dd",
             "#6ebd21",
             "#7c27a7",
             "#50bc31",
             "#bc4fd5",
             "#03bb44",
             "#c226ac",
             "#00ac30",
             "#d564ea",
             "#0f9704",
             "#fa7fff",
             "#01b852",
             "#e84cc9",
             "#01c360",
             "#e827a0",
             "#00d57e",
             "#fc4abd",
             "#4fe07c",
             "#6e31ad",
             "#dbc507",
             "#0163e7",
             "#eac10a",
             "#4c74ff",
             "#c4b600",
             "#997aff",
             "#6ca000",
             "#b878ff",
             "#549500",
             "#e282ff",
             "#008111",
             "#ff7dec",
             "#00aa4f",
             "#f1137c",
             "#01bc76",
             "#c5007f",
             "#4ede9c",
             "#a2007e",
             "#9bd761",
             "#633aa9",
             "#b4d249",
             "#5883ff",
             "#f7a005",
             "#158dff",
             "#e1a300",
             "#0165ce",
             "#97a900",
             "#be85ff",
             "#7f9f00",
             "#ec8cff",
             "#007a20",
             "#ff306d",
             "#00d7aa",
             "#f01a57",
             "#01a457",
             "#d5016c",
             "#63dd92",
             "#8a2686",
             "#77db82",
             "#7a3293",
             "#b8d15e",
             "#a890ff",
             "#a49d00",
             "#0170d2",
             "#ff7826",
             "#3699ff",
             "#db8100",
             "#5ca9ff",
             "#d14900",
             "#02c0fc",
             "#c23800",
             "#00d4d5",
             "#d9212c",
             "#00d0c5",
             "#f63948",
             "#01b78c",
             "#d20048",
             "#66dba7",
             "#c60030",
             "#00ba9e",
             "#ff475f",
             "#008b48",
             "#ff69bc",
             "#337200",
             "#ff99ef",
             "#768e00",
             "#ce9fff",
             "#808d00",
             "#424a9e",
             "#ffb442",
             "#0352a0",
             "#d09000",
             "#0190d8",
             "#d05800",
             "#49bcff",
             "#f45330",
             "#00a6c7",
             "#a92800",
             "#71d3f2",
             "#a5150c",
             "#69d9c0",
             "#b70036",
             "#00af91",
             "#b70057",
             "#9bd67e",
             "#673f92",
             "#c39700",
             "#b4a7ff",
             "#4d7600",
             "#f1afff",
             "#275f15",
             "#ff8ac0",
             "#00844d",
             "#b40044",
             "#009260",
             "#a60e1b",
             "#01afa1",
             "#ff7156",
             "#0186c0",
             "#ff9038",
             "#0d5689",
             "#cc6900",
             "#7db9ff",
             "#bc7c00",
             "#0293c0",
             "#ff8243",
             "#01a4a5",
             "#ff696f",
             "#009a75",
             "#a21732",
             "#81d6be",
             "#972e0a",
             "#69c8c2",
             "#a44a00",
             "#beb9ff",
             "#898500",
             "#82337a",
             "#b3d16d",
             "#902b66",
             "#d1c95a",
             "#4f4b8a",
             "#e1c55a",
             "#66457e",
             "#ffa84f",
             "#009080",
             "#ff7d59",
             "#008762",
             "#ff779e",
             "#195f21",
             "#ff93cb",
             "#006134",
             "#ff776b",
             "#227d6d",
             "#ff8b5e",
             "#5dae99",
             "#932a59",
             "#8fd5a7",
             "#96294a",
             "#b6cf84",
             "#763f6f",
             "#6e7a00",
             "#dbb8fc",
             "#3e5b05",
             "#ffaad5",
             "#3f5b1a",
             "#ff8c9f",
             "#2c603c",
             "#ff8b8c",
             "#397858",
             "#ffa159",
             "#b3abe2",
             "#9e8000",
             "#d8aad9",
             "#5a5f00",
             "#c487aa",
             "#7e6900",
             "#823c52",
             "#c8cb83",
             "#962b3d",
             "#78a97f",
             "#8d380e",
             "#a8bf89",
             "#873a3c",
             "#f1be65",
             "#843e2c",
             "#b4bd85",
             "#853e1c",
             "#8b9e69",
             "#ff917f",
             "#597849",
             "#ff9b65",
             "#615202",
             "#feb59c",
             "#65501b",
             "#feb871",
             "#76472b",
             "#e4c281",
             "#774725",
             "#efbd8d",
             "#994e00",
             "#cab881",
             "#b46900",
             "#82834d",
             "#ffad7f",
             "#7f5500",
             "#d08b7f",
             "#966700",
             "#9e6f4d")


Agricultural_fields <- c("Anthus_rubescens", "Asio_flammeus", "Bartramia_longicauda", "Bubulcus_ibis",
      "Calidris_mauri", "Calidris_melanotos", "Catharus_ustulatus", 
      "Elanus_leucurus", "Falco_peregrinus", "Gallinula_galeata", "Limnodromus_scolopaceus",
      "Melospiza_georgiana", "Molothrus_aeneus", "Parabuteo_unicinctus",
      "Porzana_carolina", "Recurvirostra_americana", "Riparia_riparia",
      "Selasphorus_platycercus", "Setophaga_ruticilla", "Sturnella_magna",
      "Tringa_flavipes", "Tringa_melanoleuca", "Tringa_solitaria")

Desert_scrub <- c("Aimophila_ruficeps",
                      "Amphispiza_bilineata",
                      "Artemisiospiza_nevadensis",
                      "Callipepla_squamata",
                      "Campylorhynchus_brunneicapillus",
                      "Catherpes_mexicanus",
                      "Chordeiles_minor",
                      "Icterus_parisorum",
                      "Oreoscoptes_montanus",
                      "Peucaea_cassinii",
                      "Phalaenoptilus_nuttallii",
                      "Pipilo_maculatus",
                      "Polioptila_caerulea",
                      "Polioptila_melanura",
                      "Salpinctes_obsoletus",
                      "Sialia_currucoides",
                      "Spizella_breweri",
                      "Toxostoma_crissale")

Urban_green_spaces <- c("Aechmophorus_occidentalis", "Aeronautes_saxatalis",
                            "Aix_sponsa", "Ammodramus_savannarum", 
                            "Anas_acuta",
                            "Mereca_americana",
                            "Spatula_clypeata",
                            "Mereca_strepera",
                            "Asio_otus",
                            "Aythya_affinis",
                            "Aythya_americana",
                            "Aythya_collaris",
                            "Aythya_valisineria",
                            "Bombycilla_cedrorum",
                            "Branta_canadensis",
                            "Branta_hutchinsii",
                            "Bucephala_albeola",
                            "Buteo_albonotatus",
                            "Buteogallus_anthracinus",
                            "Certhia_americana",
                            "Anser_caerulescens",
                            "Anser_rossii",
                            "Chondestes_grammacus",
                            "Cyanocitta_stelleri",
                            "Empidonax_oberholseri",
                            "Empidonax_traillii",
                            "Falco_columbarius",
                            "Ictinia_mississippiensis",
                            "Lophodytes_cucullatus",
                            "Loxia_curvirostra",
                            "Megaceryle_alcyon",
                            "Mergus_merganser",
                            "Mniotilta_varia",
                            "Myioborus_pictus",
                            "Oreothlypis_ruficapilla",
                            "Oxyura_jamaicensis",
                            "Pandion_haliaetus",
                            "Parkesia_noveboracensis",
                            "Pelecanus_erythrorhynchos",
                            "Phainopepla_nitens",
                            "Phalacrocorax_auritus",
                            "Phalacrocorax_brasilianus",
                            "Phalaropus_tricolor",
                            "Piranga_rubra",
                            "Podiceps_nigricollis",
                            "Podilymbus_podiceps",
                            "Sayornis_phoebe",
                            "Setophaga_citrina",
                            "Setophaga_graciae",
                            "Setophaga_occidentalis",
                            "Setophaga_pinus",
                            "Sialia_sialis",
                            "Sitta_canadensis",
                            "Sitta_carolinensis",
                            "Sphyrapicus_nuchalis",
                            "Sphyrapicus_thyroideus",
                            "Sphyrapicus_varius",
                            "Spinus_pinus",
                            "Spinus_tristis",
                            "Tachycineta_thalassina",
                            "Tyrannus_melancholicus",
                            "Tyto_alba",
                            "Vireo_bellii",
                            "Vireo_cassinii",
                            "Vireo_plumbeus",
                            "Vireo_solitarius")



Generalists <- c("Archilochus_alexandri",
                 "Cardellina_pusilla",
                 "Colaptes_auratus",
                 "Columba_livia",
                 "Falco_sparverius",
                 "Haemorhous_mexicanus",
                 "Hirundo_rustica",
                 "Mimus_polyglottos",
                 "Passer_domesticus",
                 "Picoides_scalaris",
                 "Quiscalus_mexicanus",
                 "Setophaga_coronata",
                 "Streptopelia_decaocto",
                 "Tyrannus_verticalis",
                 "Zenaida_asiatica",
                 "Zenaida_macroura",
                 "Zonotrichia_leucophrys")


### La opcion es ggtree
### pudiera ser la funcion groupClade pero primero necesito especificar los nodos
gzoom(phylogenetic_tree, focus = Agricultural_fields)
gzoom(phylogenetic_tree, focus = Desert_scrub, c)